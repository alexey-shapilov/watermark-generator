var images=function(){function t(){_.on("change",e),h.on("change",r),$(".modal").on("click",function(){$(this).fadeOut("fast")}),k.on("click",s),I.on("click",l)}function e(){var t=this.files[0],e=new FileReader;t&&o(t)&&(e.onload=function(t){var e=$(new Image);$("#bg__img").remove(),e.attr({src:t.target.result,id:"bg__img"}),g=e[0].width,p=e[0].height,y=v.width()/g,$("#drag__img").length&&a($("#drag__img")),n(e)},e.onerror=function(t){console.error("Error: "+t.target.error.code)},e.readAsDataURL(t),f())}function n(t){t.css({width:"100%"}).appendTo(v),b.css({minHeight:0,height:v.height()-4}),watermark.calcPositions(),watermark.setPos({left:0,top:0})}function r(){var t=this.files[0],e=new FileReader;o(t)&&(e.onload=function(t){var e=$(new Image);$("#drag__img").remove(),e.attr({src:t.target.result,id:"drag__img"}),u=e[0].width,m=e[0].height,i(e)},e.onerror=function(t){console.error("Error: "+t.target.error.code)},e.readAsDataURL(t),f())}function a(t){var e=0;return e=t[0].width*y,t.css({width:e}),t}function i(t){a(t).appendTo(w),watermark.calcPositions(),watermark.setPos({left:0,top:0})}function o(t){var e;return t.type.match("image.*")||(e="Файл должен быть изображением!"),t.size>d&&(e="Размер файла не может быть больше "+d+" байт (у этого - "+t.size+")"),e?(c(e),!1):!0}function c(t){$(".modal-error").text(t),$(".modal").fadeIn("fast")}function s(t){t.preventDefault(),c("Форма передана")}function l(t){t.preventDefault(),$("#bg__img").remove(),$("#drag__img").remove(),_.val(""),h.val(""),f(),c("Форма очищена")}function f(){var t=$(".options"),e=$(".source");return"object"==typeof $("#img-watermark")[0].files[0]?(t.show(),e.hide(),!1):(t.hide(),e.show(),!0)}var g,p,u,m,d=10485760,_=$("#img-source"),h=$("#img-watermark"),b=($("#form-control"),$("#result")),v=$("#bg__wrapper"),w=$("#watermark"),k=($("#bg__img"),$("#drag__img"),$("#but-send")),I=$("#but-reset"),y=1;return{init:function(){t(),f(),console.log("<images> init!")},getScale:function(){return y}}}();$(document).ready(function(){watermark.init(),images.init()}),$(document).ready(function(){$(".slider__range").slider({animate:!0,range:"min",value:50,min:5,max:100,step:1,change:function(t,e){$("#opacity").attr("value",e.value)}})});var watermark=function(){function t(){h.draggable({cursor:"move",snap:"#bg__wrapper",drag:o}),w.spinner(),k.spinner()}function e(){v.on("change",a),$(".position__b-link").on("click",c),w.on("spinchange",s),k.on("spinchange",l),w.on("spin",s),k.on("spin",l)}function n(){p(P)}function r(){i()}function a(t){P=$(t.target).val()/100,h.css({opacity:P}),p(P)}function i(){f(y)}function o(t,e){y={left:e.position.left,top:e.position.top},i()}function c(t){var e=$(t.target).attr("id");t.preventDefault(),u(e),$(this).addClass("position__b-link__active")}function s(){y.left=w.spinner("value")*images.getScale(),i()}function l(){y.top=k.spinner("value")*images.getScale(),i()}function f(t){$(".position__b-link").removeClass("position__b-link__active"),h.css({left:t.left,top:t.top}),g(y)}function g(){w.spinner("value",parseInt(y.left/images.getScale())),k.spinner("value",parseInt(y.top/images.getScale()))}function p(t){b.text(t)}function u(t){switch(t){case"lt":y=I.lt;break;case"ct":y=I.ct;break;case"rt":y=I.rt;break;case"lm":y=I.lm;break;case"cm":y=I.cm;break;case"rm":y=I.rm;break;case"lb":y=I.lb;break;case"cb":y=I.cb;break;case"rb":y=I.rb}i()}function m(){var t=$("#watermark").width(),e=$("#watermark").height(),n=$("#bg__wrapper").width(),r=$("#bg__wrapper").height();I={lt:{left:0,top:0},ct:{left:parseInt((n-t)/2),top:0},rt:{left:n-t,top:0},lm:{left:0,top:parseInt(r-e)/2},cm:{left:parseInt((n-t)/2),top:parseInt((r-e)/2)},rm:{left:n-t,top:parseInt((r-e)/2)},lb:{left:0,top:r-e},cb:{left:parseInt((n-t)/2),top:r-e},rb:{left:n-t,top:r-e}}}function d(){return y}function _(){return P}var h=$("#watermark"),b=($("#bg__wrapper"),$("#opacity-val")),v=$("#opacity"),w=$("#xVal"),k=$("#yVal"),I=($("#lt"),$("#ct"),$("#rt"),$("#lm"),$("#cm"),$("#rm"),$("#lb"),$("#cb"),$("#rb"),{}),y={left:0,top:0},P=.5;return{init:function(){m(),t(),n(),r(),e(),console.log("<watermark> init!")},calcPositions:m,position:d,opacity:_,setPos:f}}();